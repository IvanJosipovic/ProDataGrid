<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:DataGridSample"
             xmlns:models="clr-namespace:DataGridSample.Models"
             xmlns:viewModels="clr-namespace:DataGridSample.ViewModels"
             x:Class="DataGridSample.VariableHeightPage"
             x:DataType="viewModels:VariableHeightViewModel">
  <UserControl.DataContext>
    <viewModels:VariableHeightViewModel/>
  </UserControl.DataContext>
  
  <Grid RowDefinitions="Auto,Auto,*,Auto">
    <!-- Header -->
    <StackPanel Orientation="Vertical" Spacing="4" Grid.Row="0" Margin="0,0,0,8">
      <TextBlock Classes="h2" Text="Variable Row Height Scrolling Test"/>
      <TextBlock TextWrapping="Wrap" 
                 Text="This page tests smooth scrolling accuracy with variable row heights. Each row has a random number of lines (1-10) causing different heights."/>
    </StackPanel>

    <!-- Controls -->
    <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="12" Margin="0,0,0,8">
      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock Text="Item Count:" VerticalAlignment="Center"/>
        <NumericUpDown Minimum="10" 
                       Maximum="1000000" 
                       Value="{Binding ItemCount, Mode=TwoWay}" 
                       Increment="100"
                       Width="120"/>
      </StackPanel>
      
      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock Text="Seed:" VerticalAlignment="Center"/>
        <NumericUpDown Minimum="1" 
                       Maximum="9999" 
                       Value="{Binding Seed, Mode=TwoWay}" 
                       Increment="1"
                       Width="80"/>
      </StackPanel>
      
      <Button Content="Regenerate Items"
              Command="{Binding RegenerateCommand}"/>
      
      <Separator/>

      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock Text="Estimator:" VerticalAlignment="Center"/>
        <ComboBox Width="160"
                  ItemsSource="{Binding Estimators}"
                  SelectedItem="{Binding SelectedEstimator, Mode=TwoWay}"/>
      </StackPanel>
      
      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock Text="Scroll To:" VerticalAlignment="Center"/>
        <NumericUpDown Minimum="0" 
                       Maximum="9999" 
                       Value="{Binding ScrollToIndex, Mode=TwoWay}" 
                       Increment="10"
                       Width="100"/>
        <Button x:Name="ScrollToButton" Content="Scroll"/>
      </StackPanel>
    </StackPanel>

    <!-- DataGrid with variable row heights -->
    <DataGrid x:Name="VariableHeightDataGrid" 
              Grid.Row="2"
              CanUserResizeColumns="True" 
              CanUserReorderColumns="True" 
              CanUserSortColumns="True"
              HeadersVisibility="All"
              IsReadOnly="True"
              RowBackground="#08000000"
              GridLinesVisibility="Horizontal"
              ItemsSource="{Binding Items}">
      <DataGrid.Columns>
        <!-- Fixed width ID column -->
        <DataGridTextColumn Header="ID" 
                            Binding="{Binding Id}" 
                            Width="60"
                            x:DataType="models:VariableHeightItem"/>
        
        <!-- Fixed width title column -->
        <DataGridTextColumn Header="Title" 
                            Binding="{Binding Title}" 
                            Width="100"
                            x:DataType="models:VariableHeightItem"/>
        
        <!-- Lines count for debugging -->
        <DataGridTextColumn Header="Lines" 
                            Binding="{Binding LineCount}" 
                            Width="60"
                            x:DataType="models:VariableHeightItem"/>
        
        <!-- Expected height for debugging -->
        <DataGridTextColumn Header="Est. Height" 
                            Binding="{Binding ExpectedHeight, StringFormat='{}{0:F0}'}" 
                            Width="80"
                            x:DataType="models:VariableHeightItem"/>
        
        <!-- Variable height description column using TemplateColumn -->
        <DataGridTemplateColumn Header="Description (Variable Height)" 
                                Width="*"
                                x:DataType="models:VariableHeightItem">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate x:DataType="models:VariableHeightItem">
              <Border Padding="4" Background="Transparent">
                <TextBlock Text="{Binding Description}" 
                           TextWrapping="Wrap"
                           VerticalAlignment="Top"/>
              </Border>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
      
      <DataGrid.Styles>
        <Style Selector="DataGridRow">
          <Setter Property="Header" Value="{Binding $self.Index}"/>
        </Style>
      </DataGrid.Styles>
    </DataGrid>

    <!-- Status bar -->
    <Border Grid.Row="3" 
            Background="#20000000" 
            Padding="8,4"
            Margin="0,8,0,0">
      <StackPanel Orientation="Horizontal" Spacing="20">
        <TextBlock Text="{Binding ItemCountText}"/>
        <TextBlock Text="{Binding ScrollInfoText}"/>
        <TextBlock Text="{Binding VisibleRangeText}"/>
      </StackPanel>
    </Border>
  </Grid>
</UserControl>
